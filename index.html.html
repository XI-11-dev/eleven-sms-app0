<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ElevenSolutions SMS</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        max-width: 600px;
        margin: auto;
        background: #f5f5f5;
      }

      h1 {
        text-align: center;
        color: #333;
      }

      #messages {
        display: flex;
        flex-direction: column;
        height: 400px;
        overflow-y: scroll;
        border: 1px solid #ccc;
        padding: 10px;
        background-color: white;
        margin-bottom: 20px;
      }

      .message {
        max-width: 70%;
        margin: 6px;
        padding: 8px 12px;
        border-radius: 10px;
        font-family: sans-serif;
        display: inline-block;
        word-wrap: break-word;
      }

      .from-me {
        background-color: #d1eaff;
        text-align: right;
        align-self: flex-end;
        margin-left: auto;
      }

      .from-them {
        background-color: #f1f1f1;
        text-align: left;
        align-self: flex-start;
        margin-right: auto;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      input,
      textarea,
      button {
        padding: 10px;
        font-size: 16px;
      }

      button {
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
      }

      button:hover {
        background-color: #0056b3;
      }
    </style>
  </head>

  <body>
    <h1>ðŸ“¬ ElevenSolutions SMS</h1>

    <div id="messages"></div>

    <form id="sms-form">
      <input type="text" id="to" placeholder="Enter recipient number" required />
      <textarea id="message" placeholder="Enter your message" rows="3" required></textarea>
      <button type="submit">Send Message</button>
    </form>

    <script>
      const myNumber = "18337753445";

      const fetchMessages = async () => {
        const res = await fetch("/api/messages");
        const messages = await res.json();
        const container = document.getElementById("messages");
        container.innerHTML = "";

        messages.forEach((msg) => {
          const div = document.createElement("div");
          const from = Array.isArray(msg.from_number)
            ? msg.from_number[0]
            : msg.from_number;
          const to = Array.isArray(msg.to_number)
            ? msg.to_number[0]
            : msg.to_number;

          const isFromMe = from === myNumber;
          div.className = `message ${isFromMe ? "from-me" : "from-them"}`;
          div.textContent = msg.text;
          container.appendChild(div);
        });

        container.scrollTop = container.scrollHeight;
      };

      document.getElementById("sms-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const to = document.getElementById("to").value.trim();
        const message = document.getElementById("message").value.trim();
        if (!to || !message) return;

        await fetch("/api/send-sms", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ to, message }),
        });

        document.getElementById("message").value = "";
        await fetchMessages();
      });

      fetchMessages();
      setInterval(fetchMessages, 5000);
    </script>
  </body>
</html>
